<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>HOME</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
    <script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
</head>
<style>
    body {
        font-size: medium;
        background-color: #f2f2f2;
    }
    a {
        text-align: center;
    }
    .centerDiv {
        padding: 0 30px;
        width: 1180px;
        margin: 0 auto;
        background-color: white;
        border: 2px solid #D3D3D3;
        border-radius: 8px;
    }
    .userList {
        width: auto;
        padding: 0 30px;
        margin: 0 auto;
        background-color: white;
        border: 1px solid #D3D3D3;
        border-radius: 8px;
    }
    .forUserInfo{
        margin-top: 10px;
        margin-bottom: 10px;
    }
    .bs-example {
        margin: 20px;
    }
    .main {
        margin: 50px auto;
    }
    .form-control{
        height: 35px;
    }
    .has-search .form-control {
        padding-left: 2.375rem;
    }
    .has-search .form-control-feedback {
        position: absolute;
        z-index: 2;
        display: block;
        width: 2.375rem;
        height: 2.375rem;
        line-height: 2.375rem;
        text-align: center;
        pointer-events: none;
        color: #aaa;
    }
    .sidenav {
        margin-top: 3%;
        height: 100%;
        width: 160px;
        position: fixed;
        z-index: 1;
        top: 0;
        left: 0;
        background-color: #353D42;
        overflow-x: hidden;
        padding-top: 20px;
    }
    .sidenav a {
        padding: 6px 8px 6px 16px;
        color: #818181;
        display: block;
        margin-top: 35%;
    }
    .sidenav a:hover {
        color: #f1f1f1;
    }
    @media screen and (max-height: 450px) {
        .sidenav {
            padding-top: 15px;
        }
        .sidenav a {
            font-size: 18px;
        }
    }
    @font-face {
        font-family: 'WebSymbolsRegular';
        font-weight: normal;
        font-style: normal;
    }
    .ca-menu {
        padding: 0;
    }
    .ca-menu li {
        overflow: hidden;
        position: relative;
        display: block;
        box-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
        margin-bottom: 4px;
        transition: all 300ms linear;
    }
    .ca-menu li:last-child {
        margin-bottom: 0px;
    }
    .ca-menu li a {
        text-align: left;
        width: 100%;
        height: 50px;
        display: block;
        color: white;
    }
    .ca-content {
        position: absolute;
        height: 60px;
        top: 20px;
    }
    .ca-main {
        -webkit-transition: all 300ms linear;
        -moz-transition: all 300ms linear;
        -o-transition: all 300ms linear;
        transition: all 300ms linear;
    }
    .ca-menu li:hover {
        background: #f0f0f0;
    }
    .ca-menu li:hover .ca-main {
        opacity: 1;
        color: darkgrey;
        -webkit-animation: moveFromTop 300ms ease-in-out;
        -moz-animation: moveFromTop 300ms ease-in-out;
    }
    .ca-menu li:hover .ca-sub {
        opacity: 1;
        -webkit-animation: moveFromBottom 300ms ease-in-out;
        -moz-animation: moveFromBottom 300ms ease-in-out;

    }
    .forNameAndAut{
        width: auto;
        padding: 0px;
    }
    .selectpicker  {
        width: 100%;
        height: 30px;
        margin: 1px;}
    .keybuttonSave {
        margin: 5px;
        position: fixed;
        bottom: 0px;
        right: 0px;
        width: 100px;
        height: 8%;
        padding: 0px;
    }
    .modals {
        display: none;
        position: absolute;
        z-index: 1;
        padding-top: 100px;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        background-color: rgb(0,0,0);
        background-color: rgba(0,0,0,0.4);
    }
    .modal-contents {
        position: relative;
        background-color: #fefefe;
        margin: auto;
        padding: 0;
        border: 1px solid #888;
        width:70%;
        max-width: 400px;
        box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19);
        -webkit-animation-name: animatetop;
        -webkit-animation-duration: 0.5s;
        animation-name: animatetop;
        animation-duration: 0.5s;
        border-radius:5px;
    }
    .ok-close {
        color: white;
        font-size: 16px;
        cursor: pointer;
        width:100%;
        border-radius:5px;
        background-color: #5CB85C;
        border:none;
        padding:15px;
    }
    .modal-bodyx {
        padding: 40px 15px 15px;
        text-align:center;
    }
    .circle{
        border-radius:50%;
        background-color: #5CB85C;
        width:100px;
        height:100px;
        position: relative;
        margin: auto;
        margin-bottom:-50px;
        z-index: 1;
        -webkit-animation-name: circleappear;
        -webkit-animation-duration: 0.2s;
        animation-name: circleappear;
        animation-duration: 0.2s;
        -webkit-animation-delay: 0.5s;
        animation-delay: 0.5s;
        opacity:0;
    }
    .opened{
        opacity:1;
    }
    .fa-check{
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        -webkit-transform: translate(-50%, -50%);
        color:white;
        font-size: 38px;
    }
    .back{
        -webkit-animation-name: backtop;
        -webkit-animation-duration: 0.6s;
        animation-name: backtop;
        animation-duration: 0.6s;
    }
    .circleback{
        -webkit-animation-name: circletop;
        -webkit-animation-duration: 0.6s;
        animation-name: circletop;
        animation-duration: 0.6s;
    }
    .blurred{
        filter: blur(2px);
        -webkit-filter: blur(2px);
    }
    @-webkit-keyframes animatetop {
        0% {
            top:-300px;
            opacity:0;
        }
        80%{
            top:20px;
            opacity:1;
        }
        100%{
            top:0;
        }
    }
    @keyframes animatetop {
        0% {
            top:-300px;
            opacity:0;
        }
        80%{
            top:20px;
            opacity:1;
        }
        100%{
            top:0;
        }
    }
    @keyframes circleappear {
        0% {
            transform: scale(4);
            opacity:0;
        }
        85%{
            transform: scale(0.8);
        }
        100%{
            transform: scale(1);
            opacity:1;
        }
    }
    @-webkit-keyframes circleappear {
        0% {
            transform: scale(4);
            opacity:0;
        }
        85%{
            transform: scale(0.8);
        }
        100%{
            transform: scale(1);
            opacity:1;
        }
    }
    @keyframes backtop {
        0% {
            padding-top:100px;
            opacity:1;
        }
        100%{
            padding-top:0px;
            opacity:0;
        }
    }
    @-webkit-keyframes backtop {
        0% {
            padding-top:100px;
            opacity:1;
        }
        100%{
            padding-top:0px;
            opacity:0;
        }
    }
</style>
<body>
<div class="bodyDiv">
    <div class="row" id="forNavbar" style="margin-bottom: 0px;">
        <nav class="navbar navbar-expand-lg bg-dark navbar-dark fixed-top" style="width: 100%;">
            <a class="navbar-brand" href="#"></a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapsibleNavbar">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="collapsibleNavbar">
                <ul class="navbar-nav">
                    <div>
                        <li class="nav-item" style="width: 100px">
                            <a class="nav-link" href="#" onclick=openUsersSet()>USERS</a>
                        </li>
                    </div>
                    <div>
                        <li class="nav-item" style="width: 100px">
                            <a class="nav-link" href="#" onclick=openRolesSet()>ROLES</a>
                        </li>
                    </div>
                    <div>
                        <li class="nav-item dropdown" style="width: 100px">
                            <a class="nav-link dropdown" href="#" onclick=openKeysSet()>KEYS</a>

                            <div class="dropdown-menu">
                                <a class="dropdown-item" href="#">CARDS</a>
                                <a class="dropdown-item" href="#">FINGER PRINTS</a>
                                <a class="dropdown-item" href="#">IMAGES</a>
                            </div>
                        </li>
                    </div>
                    <div>
                        <li class="nav-item" style="width: 100px">
                            <a class="nav-link" href="#" onclick=openSysSet()>SYSTEM</a>
                        </li>
                    </div>
                </ul>


            </div>
            <ul class="nav navbar-nav " style="padding-right: 20px;">

                <li><a class="nav-link" href="#"><span class="glyphicon glyphicon-log-in"></span> Çıkış </a></li>
            </ul>
        </nav>
        <!--Finish navbar-->
    </div>
    <div class="row" id="userSetting">
        <div class="col-sm-12">
            <div class="modal fade" id="editModal" role="dialog">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title"><b>EDIT</b></h5>
                            <button type="button" class="close"  aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div id="divBodyandButton">

                        </div>
                    </div>
                </div>
            </div>
            <div class="modal fade" id="deleteModal" role="dialog">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button class="close" data-dismiss="modal" type="button">&times;</button>

                        </div>

                        <div class="modal-body" id="deleteModalBody" style="font-size: 16pt;">
                            <h1><b>Are You Sure ?</b></h1>
                            <div class="row">
                                <div class="col-xs-12" id="userDeleteDiv" style="padding: 5px 15px 5px 15px;">
                                </div>
                                <div class="col-xs-0" id="userDeleteDiv1" style="padding: 5px 15px 5px 15px;">

                                </div>
                            </div>
                        </div>

                        <div class="modal-footer">
                            <button class="btn btn-primary" onclick="deleteUser(str)" type="button">Sil</button>
                            <button class="btn btn-warning" data-dismiss="modal" type="button">Kapat</button>
                        </div>
                    </div>

                </div>
            </div>
            <div class="modal fade" id="keyModal" role="dialog">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content" style="padding: 15px;height: 500px;">
                        <div class="modal-header">
                            <h5 class="modal-title"><b>KEY MANAGMENT</b></h5>
                            <button type="button" class="close" onclick="closeEditingUserSave()" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div id="divBodyandKey">
                            <div class="row">
                                <div class="col-sm-12">
                                    <div id='allKeys' class="col-sm-5" style=" background-color: white; border: 2px solid #D3D3D3; border-radius: 8px; height: 100%;">

                                    </div>
                                    <div class="col-sm-2" id="forKeyButton" style="padding-top: 20%;padding-bottom: 20%;">
                                        <div style="text-align: center; background-color: white; border: 2px solid #D3D3D3; border-radius: 8px;"> <<  >> </div>


                                    </div>
                                    <div id="selectedKeys" class="col-sm-5" style=" background-color: white; border: 2px solid #D3D3D3; border-radius: 8px; height: 100%;">

                                    </div>
                                    <div id="keySave">
                                        <button type="button" class="btn btn-primary float-sm-right keybuttonSave"
                                                style="margin:5px;width: 25%;height: 40px;" onclick="saveEnviroment()"> Save
                                        </button>
                                    </div>

                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container">
                <div class="col-sm-2"></div>
                <div class="col-sm-8 centerDiv">
                    <div class="main">
                        <div class="form-group has-search">
                            <span class="fa fa-search form-control-feedback"></span>
                            <input type="text" id="inputSearch" class="form-control" placeholder="Search"
                                   onkeyup="searching()">
                        </div>
                        <!-- Kullanıcı listeler-->
                        <div class="bs-example">
                            <nav>
                                <ul class="pagination justify-content-center" style="width: 100%;">
                                    <div class="col-sm-12">
                                        <div class="col-sm-4">
                                            <button id="btnPrevPage" type="button" class="btn btn-light "
                                                    style="margin-right: 5px; width: 70px;" onclick="previousPage()"><<
                                            </button>

                                        </div>
                                        <div class="col-sm-4">
                                            <div id="pageNumber" >

                                            </div>

                                        </div>
                                        <div class="col-sm-4">
                                            <button id="btnNextPage" type="button" class="btn btn-light "
                                                    style="margin-right: 5px; width: 70px;" onclick="nextPage()">>>
                                            </button>
                                        </div>
                                    </div>
                                </ul>
                            </nav>
                        </div>
                    </div>
                </div>
                <div class="col-sm-2"></div>
            </div>
            <div class="container">
                <div class="col-sm-2"></div>
                <div class="col-sm-8 centerDiv2" style="padding: 0px">
                    <div id ="usersList" class="container usersList" style="width: 100%; padding: 0px;">

                    </div>
                </div>
                <div class="col-sm-2"></div>

            </div>

        </div>
    </div>
<!--    <div id="forpopup">
        <div id="popupDiv">
            <section id="fixed-form-container" class="popupCon">
                <div id="Modalss" class="modals">
                    <div class="circle" id="circle">
                        <i class="fa fa-check" id="plus-fa"></i>
                    </div>
                    <div class="modal-contents">
                        <div class="modal-bodyx">
                            <h2>Success</h2>
                            <p>Lorem ipsum dolor sit amet, at probatus maluisset theophrastus his, duo suas posidonium at.</p>
                            <button class="ok-close">OK</button>
                        </div>
                    </div>
                </div>
        </div>
            </section>
        </div>-->
    </div>
</div>
    <script>


        var optList = ["ALI", "VELI", "ELLI"];
        /*        <option value='elem_1'>elem 1</option>
                    <option value='elem_2'>elem 2</option>
                    <option value='elem_3'>elem 3</option>
                    <option value='elem_4'>elem 4</option>
                    <option value='elem_100'>elem 100</option>
        */

        var str = null;
        var currentPage;
        var currentList = [];
        var pageLi = document.getElementById('pageNumber');
        var totalPage = null;
        var allKeys = null;
        var allAvaibleKeys=null;
        var allRoles =null;
        var selectedKeys = null;
        var keySelectModalCurrentUser = [];
        var searchingValue =null;
        var selectedPage =null;
        var selectedRole=[];
       // var userSelectedAllKeys = [];

        function getPage(page, name) {
            console.log("getPage:" + page);
            console.log("getPage:" + name);
            var api = "http://localhost:8080/admin/userlistAPI?pageNo=" + page;
            if (name != null) {
                api += "&name=" + name;
            }
            $.ajax({
                url: api,
                contentType: 'application/json',
                traditional: true,
                dataType: 'json',
                processData: false,
                type: 'POST',
                success: function (data) {
                    var status = data.status;
                    str = data.data;
                    totalPage = data.data.totalPages;
                    if (data.successful == true) {
                        currentPage = str;
                        if (currentPage.isFirst) {
                            $('#btnPrevPage').prop('disabled', true)
                        }
                        else {
                            $("#btnPrevPage").prop('disabled', false);
                        }
                        if (currentPage.isLast) {
                            $("#btnNextPage").prop('disabled', true);
                        }
                        else {
                            $("#btnNextPage").prop('disabled', false);
                        }

                        pageLi.innerHTML = "";
                        var html = '<select id ="selectPage" onchange="search(this.value)" class="form-control" style="height: 100%">';
                        if(currentPage.totalPages ==0 ){currentPage.totalPages=1;}
                        for (var i = 0; i < currentPage.totalPages; i++) {
                            if (i == page) {
                                html += "<option value='" + i + "' selected='selected'>" + i + "</option>";
                            } else {
                                html += "<option value='" + i + "' >" + i + "</option>";
                            }
                        }
                        html += "</select>";
                        pageLi.innerHTML = html;
                        currentList = str.list;
                        listing(str);
                        if (status == 0) {
                            console.log("device control succeeded");
                        }
                    }
                },
                error: function (data) {
                    console.log("Device control failed" + data);
                }
            })
        }

        function searching(){
            var tmpSelectTag=document.getElementById("selectPage");
            selectedPage = tmpSelectTag.options[tmpSelectTag.selectedIndex].value;

            searchingValue=inputSearch.value.toUpperCase();

            getPage(selectedPage,searchingValue);

        }

        function listing(str) {
            var myObject = str.list;
            var mainContainer = document.getElementById('usersList');
            var tempDiv = "";
/*
            var currentQuery = inputSearch.value.toUpperCase();
*/
            for (var i in myObject) {
                var user = myObject[i];
                var name = user.userName;
                var surname = user.userSurname;
                var role = user.userRoles[0].role;
                key = user.key;
                var tc = user.tc;
                var email = user.userEmail;
                var temp = "";
                /*if (currentQuery != "" && (!name.includes(currentQuery) && !surname.includes(currentQuery))) {
                    continue;
                }*/

                temp += '<div class="container userList" >';
                temp += '<div class="col-sm-8 forUserInfo">';
                temp += '<div class="container forNameAndAut">';
                temp += '<div class="col-sm-4">' + name + ' ' + surname + '</div>';
                temp += '<div class="col-sm-2" style="background-color: red;color: white;text-align: center">' + role + '</div>';
                temp += '<div class="col-sm-6"></div> </div>';
                temp += '<div class="container forInfo" style="font-size: 10px;font-style: italic">';
                temp += '<div>' + tc + '</div>'; //T.C. gelecek
                temp += '<div>' + email + '</div></div> ';   //Tel No gelecel
                for (var j in user.key) {

                    temp += '<div class="container keyInfo" >' + user.key[j].keyName + '</div>';
                }
                temp += ' </div>';
                temp += '<div class="col-sm-4 forButtons">';
                temp += '<div style="margin-top: 10px; margin-bottom: 5px;">';
                temp += '<button type="button" class="btn btn-primary " style="margin-right: 5px; width: 70px;" onclick="editingModal(' + user.id + ')">EDIT</button>';
                temp += '<button type="button" class="btn btn-primary " style="width: 70px; padding-left:7px;"  onclick="deleteModal(' + user.id + ')" >DELETE</button> </div >';
                temp += '<div style="margin-top: 10px; margin-bottom: 5px;"><button type="button" class="btn btn-primary " style="width: 145px;" onclick="keyModal(' + user.id + ')">KEY MANAGMENT</button></div> </div> </div>';
                tempDiv += temp;
            }
            usersList.innerHTML = tempDiv;
        }

        $(document).ready(function () {
            $("#fixed-form-container .body").hide();
            getPage(0);
            getAllKeys();
            getAllRoles();

        })

        function toggleModalKeySelection(keyId) {
            var key = null;
            for (var i in allAvaibleKeys) {
                var temp = allAvaibleKeys[i];
                if (temp.id == keyId) {
                    key = temp;
                    break;
                }
            }
            for (var i in selectedKeys) {
                var temp = selectedKeys[i];
                if (temp.id == keyId) {
                    key = temp;
                    break;
                }
            }
            if (key == null) {
                return;
            }
            var index = selectedKeys.indexOf(key);
            if (index != -1) {
                var newArray = [];
                for (var i in selectedKeys) {
                    var tmp = selectedKeys[i];
                    if (tmp.id != keyId) {
                        newArray.push(tmp);
                    }
                }
                selectedKeys = newArray;
                allAvaibleKeys.push(key);
            } else {

                var tempAllKeys=allAvaibleKeys.filter(function (e){
                    return e!==key;
                })

                allAvaibleKeys=tempAllKeys;
                selectedKeys.push(key);

                }


            renderKeyModal();
        }

        function closeEditingUserSave(){

            getAllAvailableKeys();
            renderKeyModal();
            $('#keyModal').modal('toggle');
        }

        function renderKeyModal(keySelectModalCurrentUser) {
            if (allAvaibleKeys == null) {
                return;
            }
            var allKeysDiv = document.getElementById("allKeys");
            var selectedKeysDiv = document.getElementById("selectedKeys");
            allKeysDiv.innerHTML = "";
            selectedKeysDiv.innerHTML = "";
            var temp = "";
            if(selectedKeys ==null){
                selectedKeys=0;
            }

            for (var i in selectedKeys) {
                var key = selectedKeys[i];
                    temp += "<div onclick='toggleModalKeySelection(" + key.id + ")'>";
                    temp += key.keyName;
                    temp += "</div>";
                }

            selectedKeysDiv.innerHTML = temp;
            temp = "";
            for (var i in allAvaibleKeys) {
                var key = allAvaibleKeys[i];
                var isThisAlreadySelected = false;
                for (var k in selectedKeys) {
                    var tempSelected = selectedKeys[k];
                    if (tempSelected.id == key.id) {
                        isThisAlreadySelected = true;
                        break;
                    }
                }
                if (isThisAlreadySelected) {
                    continue;
                }
                temp += "<div onclick='toggleModalKeySelection(" + key.id + ")'>";
                temp += key.keyName;
                temp += "</div>";
            }
            allKeysDiv.innerHTML = temp;
        }

        function getAllAvailableKeys() {
            $.ajax({
                url: "http://localhost:8080/admin/availableKeyAPI",
                contentType: 'application/json',
                traditional: true,
                dataType: 'json',
                processData: false,
                type: 'POST',
                success: function (data) {
                    var list = data.data;
                    allAvaibleKeys = list;
                    renderKeyModal();
                },
                error: function (data) {
                    console.log("Device control failed" + data);
                }
            })
        }

        function getAllKeys() {
            $.ajax({
                url: "http://localhost:8080/admin/keysListAPI",
                contentType: 'application/json',
                traditional: true,
                dataType: 'json',
                processData: false,
                type: 'POST',
                success: function (data) {
                    var list = data.data;
                    allKeys = list;
                    renderKeyModal();
                },
                error: function (data) {
                    console.log("Device control failed" + data);
                }
            })
        }

        function getAllRoles() {
            $.ajax({
                url: "http://localhost:8080/admin/rolesListAPI",
                contentType: 'application/json',
                traditional: true,
                dataType: 'json',
                processData: false,
                type: 'POST',
                success: function (data) {
                    var list = data.data;
                    allAvaibleRoles = list;
                },
                error: function (data) {
                    console.log("Device control failed" + data);
                }
            })


        }

        function keyModal(id) {
            var containUserKeyBefore =null;

            for (var i in str.list) {
                if (str.list[i].id == id) {
                    keySelectModalCurrentUser = str.list[i].key;
                }
            }
            for(i in allAvaibleKeys){
                if(allAvaibleKeys.includes(keySelectModalCurrentUser[i]) ){
                    containUserKeyBefore=true;
                }
            }
                for(i in selectedKeys){
                    if( selectedKeys.includes(keySelectModalCurrentUser[i])){
                        containUserKeyBefore=true;
                    }

            }
            if (keySelectModalCurrentUser != null && containUserKeyBefore!=true){
                selectedKeys = keySelectModalCurrentUser;
            }

            renderKeyModal(keySelectModalCurrentUser);

            if (allAvaibleKeys == null) {
                getAllAvailableKeys();
            }

            $("#keyModal").modal('show');

        }

        function saveEnviroment() {
            if (keySelectModalCurrentUser == null) {
                return;
            }
            $.ajax({
                url: "http://localhost:8080/admin/enrollUserKeyAPI?user_id=" + keySelectModalCurrentUser,
                        contentType: 'application/json',
                data: JSON.stringify({env: selectedKeys}),
                        traditional: true,
                        dataType: 'json',
                        processData: false,
                        type: 'POST',
                        success: function (data) {
                            alert("Kayıt Başarılı");
                        },
                        error: function (data) {
                            console.log("Device control failed" + data);
                        }
            });

            }

        function editingModal(id) {
            $("#editModal").modal('show');
            var divBodyandButton = document.getElementById("divBodyandButton");
            var tempModal = "";
            for (var i in currentList) {
                var user = currentList[i];
                var temp = "";
                if (user.id == id) {
                    temp += '<div class="modal-body" id="editModalBody">';
                    temp += '<input class="form-control" id="nameEdit" placeholder="Name" type="text" value="' + user.userName + '"/>';
                    temp += '<input class="form-control" id="lastNameEdit" placeholder="Surname" type="text" value="' + user.userSurname + '"/>';
                    temp += '<input class="form-control" id="emailEdit" placeholder="E-Mail" type="text" value="' + user.userEmail + '"/>';
                    temp += '<input class="form-control" id="passwordEdit" placeholder="Password"/>';
                    temp += '<input class="form-control" id="passwordEdit2" placeholder="Password Verify" />';
                    temp += '<select class="selectpicker" id="roleEdit">';
                    for (var i in allRoles){
                        temp += '<option style= class="form-control"  placeholder="Role" type="text" value="' + allRoles[i]+ '">'+ allRoles[i].role +'</option>'; //Selection box gelecek

                    }
                    temp += '<input class="form-control" id="tcEdit" placeholder="TC" type="text" value="' + user.tc + '"/>';
                    temp += '</div>';
                    temp += '<div class="modal-footer">';
                    temp += '<button type="button" id="editSave" onclick="editSave(' + user.id + ');" class="btn btn-primary">Save changes</button>';
                    temp += '<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>';
                    temp += '</div>';
                    tempModal += temp;
                }
            }
            divBodyandButton.innerHTML = tempModal;
            /*$("#editModal").modal().show();*/

        }

        function editSave(id) {
            var selectedRoleIndex= roleEdit.selectedIndex;
            selectedRole=allRoles[selectedRoleIndex];
            var user = [];
            var name = nameEdit.value;
            var surname = lastNameEdit.value;
            var email = emailEdit.value;
            var password = passwordEdit.value;
            var tc = tcEdit.value;
            var roles =[];
            roles.push(selectedRole);
            $(".error").hide();
            var hasError = false;
            var errorType = "";
            var checkVal = $("#passwordEdit2").val();
            // if (passwordVal.length < 8 || passwordVal.length < 8) {
            //     $("#password").after('<span class="error">Lütfen paralonızı 8 karakterdem fazla girin.</span>');
            //     hasError = true;
            // }
            if (password != checkVal) {
                $("#passwordEdit2").after('<span class="error">Parolanız eşleşmedi.</span>');
                hasError = true;
            }
            user = {
                id: id,
                userName: name,
                userSurname: surname,
                userEmail : email,
                userRoles:roles,
                tc: tc
            };
            $.ajax({
                url: "http://localhost:8080/admin/updateUserAPI",
                contentType: 'application/json',
                traditional: true,
                data: JSON.stringify(user),
                dataType: 'json',
                processData: false,
                type: 'POST',
                success: function (data) {
                    var status = data.status;
                    str = data.Objectdata;
                    if (data.successful == true) {
                        $('#editModal').modal('toggle');
                        $("#fixed-form-container .body").show();
                        $(".popupCon").fadeToggle(3000);
                        console.log("Kapatıldı");
                        console.log(str);
                    }
                },
                error: function (data) {
                    console.log("Device control failed" + data);
                }
            })
        }

        $("select.selectPage").change(function () {
            selectedPage = $("#select").children("option:selected").val();
            getPage(selectedPage);
        });

        function deleteModal(id) {
            var deleteModal = document.getElementById("deleteModal");
            $("#deleteModal").modal('show');

        }

        function deleteUser(id) {
            $.ajax({
                url: "http://localhost:8080/admin/userDeleteAPI",
                contentType: 'application/json',
                traditional: true,
                data: JSON.stringify(id),
                dataType: 'json',
                processData: false,
                type: 'POST',
                success: function (data) {
                    var status = data.status;
                    str = data.Objectdata;
                    if (data.successful == true) {
                        $('#editModal').modal('toggle');
                        $("#fixed-form-container .body").show();
                        $(".popupCon").fadeToggle(3000);
                        console.log("Kapatıldı");
                        console.log(str);
                    }
                },
                error: function (data) {
                    console.log("Device control failed" + data);
                }
            })
        }

        function previousPage() {
            if (!currentPage.isFirst) {
                search(currentPage.number - 1);
            }
        }

        function nextPage() {
            if (!currentPage.isLast) {
                search(currentPage.number + 1);
            }
        }

        function search(page) {
            page = (page == null) ? 0 : page;
            getPage(page);
        }

        function openUsersSet() {

            var x = document.getElementById("userSetting");
            if (x.style.display === "none") {
                x.style.display = "block";
                document.getElementById('roleSetting').style.display = "none";
                document.getElementById('keySetting').style.display = "none";
                document.getElementById('systemSetting').style.display = "none";
            } else {
                document.getElementById('roleSetting').style.display = "none";
                document.getElementById('keySetting').style.display = "none";
                document.getElementById('systemSetting').style.display = "none";
            }
        }

        function openRolesSet() {

            window.location.href = "http://localhost:8080/admin/role";

        }

        function openKeysSet() {
            window.location.href = "http://localhost:8080/admin/key";

        }

        function openSysSet() {
            window.location.href = "http://localhost:8080/admin/system";

        }


    </script>
</div>
</body>
</html>